@page "/c4-diagram"
@inject D2Wrapper D2Wrapper
@rendermode InteractiveServer

<PageTitle>C4 Diagram - ArchDiagram</PageTitle>

<div class="container">
    <h1 class="mb-4">C4 Diagram - Online Shopping System</h1>

    <div class="row mb-4">
        <div class="col-md-12">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" @onclick="() => ShowDiagramLevel(1)">Level 1: System Context</button>
                <button type="button" class="btn btn-primary" @onclick="() => ShowDiagramLevel(2)">Level 2: Container</button>
                <button type="button" class="btn btn-primary" @onclick="() => ShowDiagramLevel(3)">Level 3: Component</button>
                <button type="button" class="btn btn-primary" @onclick="() => ShowDiagramLevel(4)">Level 4: Code</button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="svg-container">
                        @((MarkupString)RenderedSvg)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .svg-container {
        width: 100%;
        padding-top: 100%;
        position: relative;
    }

    .svg-container svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
</style>

@code {
    private string RenderedSvg { get; set; } = "";

    protected override void OnInitialized()
    {
        ShowDiagramLevel(1);
    }

    private void ShowDiagramLevel(int level)
    {
        string diagramScript = "";

        switch (level)
        {
            case 1:
                diagramScript = @"
                    direction: right
                    Customer -> OnlineShoppingSystem: Places orders
                    Customer <- OnlineShoppingSystem: Displays products, order status
                    OnlineShoppingSystem -> PaymentGateway: Sends payment requests
                    OnlineShoppingSystem <- PaymentGateway: Confirms payment
                    OnlineShoppingSystem -> ShippingProvider: Sends shipping requests
                    OnlineShoppingSystem <- ShippingProvider: Provides shipping status
                ";
                break;
            case 2:
                diagramScript = @"
                    direction: down
                    Customer -> WebApplication: Uses web interface
                    Customer -> MobileApp: Uses mobile app
                    WebApplication -> APIGateway: Sends requests
                    WebApplication <- APIGateway: Returns responses
                    MobileApp -> APIGateway: Sends requests
                    MobileApp <- APIGateway: Returns responses
                    APIGateway -> OrderService: Forwards order requests
                    APIGateway <- OrderService: Returns order data
                    APIGateway -> ProductService: Forwards product requests
                    APIGateway <- ProductService: Returns product data
                    APIGateway -> CustomerService: Forwards customer requests
                    APIGateway <- CustomerService: Returns customer data
                    OrderService -> OrderDatabase: Reads from and writes to
                    ProductService -> ProductDatabase: Reads from and writes to
                    CustomerService -> CustomerDatabase: Reads from and writes to
                ";
                break;
            case 3:
                diagramScript = @"
                    direction: right
                    WebApplication -> ProductCatalog: Requests product data
                    WebApplication <- ProductCatalog: Returns product data
                    WebApplication -> ShoppingCart: Manages cart data
                    WebApplication <- ShoppingCart: Returns cart data
                    WebApplication -> OrderManagement: Places orders
                    WebApplication <- OrderManagement: Returns order status
                    MobileApp -> ProductCatalog: Requests product data
                    MobileApp <- ProductCatalog: Returns product data
                    MobileApp -> ShoppingCart: Manages cart data
                    MobileApp <- ShoppingCart: Returns cart data
                    MobileApp -> OrderManagement: Places orders
                    MobileApp <- OrderManagement: Returns order status
                    ProductService -> ProductCatalog: Provides product data
                    OrderService -> OrderManagement: Manages order processing
                    CustomerService -> CustomerProfile: Manages customer profiles
                ";
                break;
            case 4:
                diagramScript = @"
                    direction: right
                    ProductCatalog -> GetProducts: Retrieves products
                    ProductCatalog <- GetProducts: Returns products
                    ProductCatalog -> SearchProducts: Searches products
                    ProductCatalog <- SearchProducts: Returns matching products
                    ShoppingCart -> AddToCart: Adds item to cart
                    ShoppingCart <- AddToCart: Confirms addition
                    ShoppingCart -> RemoveFromCart: Removes item from cart
                    ShoppingCart <- RemoveFromCart: Confirms removal
                    ShoppingCart -> UpdateQuantity: Updates item quantity
                    ShoppingCart <- UpdateQuantity: Confirms update
                    OrderManagement -> CreateOrder: Creates an order
                    OrderManagement <- CreateOrder: Returns order details
                    OrderManagement -> CancelOrder: Cancels an order
                    OrderManagement <- CancelOrder: Confirms cancellation
                    OrderManagement -> TrackOrder: Tracks an order
                    OrderManagement <- TrackOrder: Returns order status
                    CustomerProfile -> GetCustomerDetails: Retrieves customer details
                    CustomerProfile <- GetCustomerDetails: Returns customer details
                    CustomerProfile -> UpdateCustomerDetails: Updates customer details
                    CustomerProfile <- UpdateCustomerDetails: Confirms update
                ";
                break;
        }

        RenderedSvg = D2Wrapper.RenderDiagram(diagramScript) ?? "";
    }
}
